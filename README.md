# Crosschain Secret Mint

A cross-chain atomic swap system where Bitcoin payment unlocks NFT minting on Ethereum or Solana through shared secrets using Hash Time Locked Contracts (HTLC).

**⚠️ Warning:** This is experimental software. Please do not use with real funds without thorough testing and security audit.

## Overview

This system enables trustless atomic swaps between Bitcoin and Ethereum/Solana NFTs:

1. **Buyer locks Bitcoin** in an HTLC using a secret hash
2. **Seller commits NFT** on Ethereum or Solana using the same secret hash  
3. **Buyer reveals secret** to mint the NFT on Ethereum or Solana
4. **Seller claims Bitcoin** using the revealed secret from Ethereum or Solana

## Status

### DONE

- [x] Bitcoin HTLC (script locking mechanism)
- [x] Ethereum NFT (standard ERC721) contract
- [x] Bitcoin client
- [x] Ethereum client
- [x] End-to-end demo for BTC<=>ETH swap

### TODO

- [ ] Solana HTLC program
- [ ] Solana client
- [ ] Architectural diagram

## End-to-end Demo

## Prerequisites

### System Requirements

- **Rust** 1.75+ with Cargo
- **Node.js** 18+ with npm/yarn
- **Bitcoin Core** (for regtest mode)
- **Hardhat** development environment

### Development Tools

```bash
# Install Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Install Node.js (via nvm recommended)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install --lts
nvm use --lts

# Install Bitcoin Core (Ubuntu/Debian)
sudo apt-get update
sudo apt-get install bitcoind

# Or via Homebrew (macOS)
brew install bitcoin
```

## Quick Start

### 1. Setup

```bash
# Clone repo
git clone https://github.com/kobby-pentangeli/crosschain-secret-mint.git
cd crosschain-secret-mint

# Set up the demo paramters and runners
./setup.sh
```

The setup script automatically:

- Installs missing prerequisites (Bitcoin Core, dependencies)
- Builds the Rust `client`
- Configures and starts Bitcoin regtest node
- Deploys Ethereum NFT contract on local Hardhat network
- Generates funded test accounts for both networks
- Creates ready-to-use demo configuration

### 2. Run Demo

#### 2.1 Load config and lock BTC

**NOTE**: The setup script prefunds the buyer's BTC wallet ("testwallet") before running the rest of the flow, but to avoid running into a potential "insufficient funds" error, mine some blocks with the following command:

```bash
# project root
bitcoin-cli -regtest -datadir=.bitcoin generatetoaddress 101 <BUYER_BTC_ADDRESS>
```

Copy-paste the <BUYER_BTC_ADDRESS> from the `atomic_swap.sh` demo config file that was generated by the setup script. Once you have enough BTC, proceed with the flow.

```bash
# 1. (BUYER): Run this to simulate buyer locking funds on Bitcoin
source ./atomic_swap.sh && lock_btc
```

The above command will load the demo config and execute the first step of the swap. Upon success, you should see the **SECRET**, **SECRET_HASH**, and **LOCK_TXID** in stdout. We log this for demo only. Keep an eye on those three values, as you'll need them for claiming the BTC.

#### 2.2 Commit the NFT

```bash
# 2. (SELLER): Run this for the seller to commit to the NFT
commit_for_mint <SECRET_HASH>
```

#### 2.3 Mint with secret

```bash
# 3. (BUYER): Run this for the buyer to mint NFT via reveal.
mint_with_secret <SECRET>
```

#### 2.4 Claim bitcoin

```bash
# 4. (SELLER): Run this for the seller to claim BTC upon reveal
claim_btc <SECRET> <SECRET_HASH> <LOCK_TXID>
```

### Custom Parameters

Modify the generated `atomic_swap.sh` to customize the demo run:

```bash
# Edit amounts, token IDs, metadata, etc.
export BTC_AMOUNT="2000000"      # 0.02 BTC
export NFT_PRICE="2000000000000000000"  # 2 ETH
export TOKEN_ID="42"
export METADATA_URI="https://your-nft-metadata.json"
```

## Configuration Parameters

### Bitcoin Parameters

- `--btc-rpc`: Bitcoin RPC URL (default: <http://localhost:18443>)
- `--btc-user`: RPC username (default: user)  
- `--btc-pass`: RPC password (default: password)
- `--btc-network`: Network type (regtest/testnet/mainnet)
- `--btc-amount`: Amount in satoshis (default: 100000 = 0.001 BTC)
- `--timeout`: HTLC timeout in blocks (default: 144 ≈ 24 hours)

### Ethereum Parameters

- `--eth-rpc`: Ethereum RPC URL (default: <http://localhost:8545>)
- `--nft-contract`: Deployed NFT contract address
- `--nft-price`: NFT price in wei (default: 1 ETH)
- `--token-id`: NFT token ID to mint
- `--metadata-uri`: NFT metadata URL

## Contributing

Thank you for considering contributing to this project! All contributions large and small are actively accepted.

- To get started, please read the [contribution guidelines](https://github.com/kobby-pentangeli/crosschain-secret-mint/blob/main/CONTRIBUTING.md).

- Browse [Good First Issues](https://github.com/kobby-pentangeli/crosschain-secret-mint/labels/good%20first%20issue).

## License

Licensed under either of [Apache License, Version 2.0](./LICENSE-APACHE) or [MIT license](./LICENSE-MIT) at your option.

Unless you explicitly state otherwise, any contribution intentionally submitted for inclusion in this codebase by you, as defined in the Apache-2.0 license, shall be dual licensed as above, without any additional terms or conditions.
